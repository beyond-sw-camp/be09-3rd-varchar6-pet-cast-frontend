<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varchar6.petcast.domain.request.repository.RequestMapper">

    <!-- 고객 요청서 목록 조회 -->
    <select id="findAllRequestsByMemberId" resultType="com.varchar6.petcast.domain.request.repository.RequestMapper">
        SELECT
            r.id,
            r.content,
            r.created_at,
            r.status
        FROM
            tbl_request r
                INNER JOIN tbl_member m ON r.member_request_id = m.id
        WHERE
            m.id = #{member_id}
        ORDER BY created_at DESC;
    </select>

    <!-- 업체 요청서 목록 조회 -->
    <select id="findAllRequestsByCompanyId" resultType="com.varchar6.petcast.domain.request.repository.RequestMapper">
        SELECT
            r.id,
            m.name AS member_name,
            r.content,
            r.created_at,
            r.status
        FROM
            tbl_request r
                INNER JOIN tbl_member m ON r.member_request_id = m.id
        where m.id = #{company_id}
        ORDER BY created_at DESC;
    </select>

    <!-- 고객 특정 요청서 조회 -->
    <select id="findRequestById" parameterType="int" resultType="com.varchar6.petcast.domain.request.repository.RequestMapper">
        SELECT
            r.id,
            m.name,
            r.content,
            r.cost,
            r.location,
            r.time,
            r.status,
            r.created_at,
            r.updated_at,
            r.active,
            r.company_info_request_id,
            r.member_request_id,
            GROUP_CONCAT(c.name SEPARATOR ', ')
        FROM
            tbl_request r
                INNER JOIN tbl_member m ON r.member_request_id = m.id
                INNER JOIN tbl_request_category rc ON r.id = rc.request_id
                INNER JOIN tbl_category c ON rc.category_id = c.id
        WHERE
            r.id = #{요청서_아이디};
    </select>

</mapper>